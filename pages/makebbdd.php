<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>ERP 2DAM - Inicialización</title>

    <!-- Bootstrap Core CSS -->
    <link href="../bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="../bower_components/metisMenu/dist/metisMenu.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../dist/css/sb-admin-2.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="../bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">Inicio</a>
            </div>
            <!-- /.navbar-header -->

            <ul class="nav navbar-top-links navbar-right">
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-refresh fa-spin"></i>  <i class="fa fa-caret-down"></i>
                    </a>

                    <!-- /.dropdown-messages -->
                </li>
				<li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-envelope fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-messages">
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>Read All Messages</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-messages -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-tasks fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-tasks">
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 1</strong>
                                        <span class="pull-right text-muted">40% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                            <span class="sr-only">40% Complete (success)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 2</strong>
                                        <span class="pull-right text-muted">20% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%">
                                            <span class="sr-only">20% Complete</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 3</strong>
                                        <span class="pull-right text-muted">60% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                            <span class="sr-only">60% Complete (warning)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 4</strong>
                                        <span class="pull-right text-muted">80% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                            <span class="sr-only">80% Complete (danger)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>See All Tasks</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-tasks -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-bell fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-alerts">
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-comment fa-fw"></i> New Comment
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                    <span class="pull-right text-muted small">12 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-envelope fa-fw"></i> Message Sent
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-tasks fa-fw"></i> New Task
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>See All Alerts</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-alerts -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="#"><i class="fa fa-user fa-fw"></i> User Profile</a>
                        </li>
                        <li><a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="login.html"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
            <!-- /.navbar-top-links -->

            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li class="sidebar-search">
                            <div class="input-group custom-search-form">
                                <input type="text" class="form-control" placeholder="Buscar...">
                                <span class="input-group-btn">
                                <button class="btn btn-default" type="button">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                            </div>
                            <!-- /input-group -->
                        </li>
                        <li>
                            <a href="index.html"><i class="fa fa-dashboard fa-fw"></i> Dashboard</a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-wrench fa-fw"></i> Productos<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li>
                                    <a href="prod_list.html">Listar</a>
                                </li>
                                <li>
                                    <a href="Prod_edit.html">Editar</a>
                                </li>
                                <li>
                                    <a href="Prod_insert.html">Insertar</a>
                                </li>
                                <li>
                                    <a href="Prod_delete.html">Borrar</a>
                                </li>
                             
                            </ul>
                            <!-- /.nav-second-level -->
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-edit fa-fw"></i> Clientes<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li>
                                    <a href="cust_list.html">Listar</a>
                                </li>
                                <li>
                                    <a href="cust_edit.html">Editar</a>
                                </li>
                                <li>
                                    <a href="cust_insert.html">Insertar</a>
                                </li>
                                <li>
                                    <a href="cust_delete.html">Borrar</a>
                                </li>
                             
                            </ul>
                            <!-- /.nav-second-level -->
                        </li>
						
						<li>
                            <a href="#"><i class="fa fa-table fa-fw"></i> Pedidos<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li>
                                    <a href="order_list.html">Listar</a>
                                </li>
                                <li>
                                    <a href="order_edit.html">Editar</a>
                                </li>
                                <li>
                                    <a href="order_insert.html">Insertar</a>
                                </li>
								<li>
                                    <a href="order_insert.html">Confirmar</a>
                                </li>
                                <li>
                                    <a href="order_delete.html">Borrar</a>
                                </li>
                             
                            </ul>
                            <!-- /.nav-second-level -->
                        </li>
						
						<li>
                            <a href="#"><i class="fa fa-bar-chart-o fa-fw"></i> Ventas<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li>
                                    <a href="sales_list.php">Listar</a>
                                </li>
                                <li>
                                    <a href="sales_graph.php">Gráficos</a>
                                </li>
                            </ul>
                            <!-- /.nav-second-level -->
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-pencil fa-fw"></i> Recurso Humanos<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li>
                                    <a href="employ_list.html">Listar</a>
                                </li>
                                <li>
                                    <a href="employ_edit.html">Editar</a>
                                </li>
                                <li>
                                    <a href="employ_insert.html">Insertar</a>
                                </li>
								<li>
                                    <a href="employ_print.html">Imprimir</a>
                                </li>
                                <li>
                                    <a href="employ_delete.html">Borrar</a>
                                </li>
								<li>
                                    <a href="employ_config.html">Configuracion</a>
                                </li>
                            </ul>
                            <!-- /.nav-second-level -->
                        </li>
                        
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <!-- Page Content -->
        <div id="page-wrapper">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12">
                        <h1 class="page-header">Inicializando Base de datos...</h1>
						<?php
							
							// Esta función ejecuta una query y trata el error si lo hubiera
							function ejecuta_query($link, $query){
								
								// Realizamos la query
								if (mysqli_query($link, $query)) {
								echo "Datos guardados";
									return true;
								} else {
									$cadena = mysqli_error($link);
									$buscar = "Duplicate entry";
									$resultado = strpos($cadena, $buscar);

									if($resultado !== FALSE){
										echo "Ese usuario ya existe";
										return false;
									}
									echo "<h1>Registro Fallido</h1>";
									printf("Error: %s\n", mysqli_error($link));
								}
							}
							
							function insert_departamento($id_dept,$departamento,$link)
							{
								// creamos el INSERT sobre la tabla FACTURAS
								$query = 'INSERT INTO Departamentos VALUES ('. $id_dept .', "'. $departamento .'")';
								ejecuta_query($link,$query);
							}
							
							
							function insert_contrato($id_dept,$contrato,$link)
							{
								// creamos el INSERT sobre la tabla Contratos
								$query = 'INSERT INTO Contratos VALUES ('. $id_dept .', "'. $contrato .'")';
								ejecuta_query($link,$query);
							}
							
							function insert_puestos($id_dept,$nombre_puesto,$salario,$descripcion,$estudios_req, $link){
                            // creamos el INSERT sobre la tabla FACTURAS
                            $query = 'INSERT INTO Puestos VALUES ('. $id_dept .', "'. $nombre_puesto .'", '. $salario .', "'. $descripcion .'", "'. $estudios_req .'")';
                            ejecuta_query($link,$query);
                        }
							
							
							$servername = "localhost";
							$username = "root";
							$password = "";
							$dbname = "ERPDB";

							$conn = mysqli_connect($servername,$username,$password);
							$sql = "CREATE DATABASE ".$dbname;
							$result = mysqli_query($conn, $sql);
							// Create connection
							$conn = new mysqli($servername, $username, $password, $dbname);
							// Check connection
							if ($conn->connect_error) {
								die("Connection failed: " . $conn->connect_error);
							}

							//sql to create table login
							$sql = "CREATE TABLE Login(
							User VARCHAR(10) PRIMARY KEY,
							Password VARCHAR(50) NOT NULL,
							Email VARCHAR(50) NOT NULL
							)";

							if ($conn->query($sql) === TRUE) {
								echo "Table Login created successfully<br />";
							} else {
								echo "Error creating table: " . $conn->error."<br />";
							}

							//sql to create table client
							$sql = "CREATE TABLE Clientes(
							Id_cliente INT NOT NULL AUTO_INCREMENT,
							Nombre_cliente CHAR(50),
							Apellido_cliente CHAR(50),
							Logo_empresa LONGBLOB NOT NULL,
							Nombre_empresa CHAR(50),
							Direccion CHAR(70),
							Telefono INT(12),
							Email CHAR(50),
							CONSTRAINT PK PRIMARY KEY (Id_cliente)
							)";

							if ($conn->query($sql) === TRUE) {
								echo "Table Clientes created successfully<br />";
							} else {
								echo "Error creating table: " . $conn->error."<br />";
							}

							// sql to create table Productos
							$sql = "CREATE TABLE Productos(
							Id_Producto INTEGER(6) NOT NULL,
							Denominacion VARCHAR(20) NOT NULL,
							Pvp INTEGER(7) NOT NULL,
							Precio_Coste INTEGER(6) NOT NULL,
							Ubicacion VARCHAR(10) NOT NULL,
							Nombre_Proveedor VARCHAR(20) NOT NULL,
							Stock INTEGER(7) NOT NULL,
							Imagen_Producto VARCHAR(30),
							CONSTRAINT PK PRIMARY KEY (Id_Producto)
							)";

							if ($conn->query($sql) === TRUE) {
								echo "Table Productos created successfully<br />";
							} else {
								echo "Error creating table: " . $conn->error."<br />";
							}

							// sql to create table Puestos
							$sql = "CREATE TABLE Puestos (
							Id_puesto INT AUTO_INCREMENT,
							Nombre_puesto VARCHAR (20) NOT NULL,
							Salario INT NOT NULL,
							Descripcion VARCHAR (100),
							Estudios_req VARCHAR (30) NOT NULL,
							CONSTRAINT PK PRIMARY KEY (Id_puesto)
							)";

							if ($conn->query($sql) === TRUE) {
								echo "Table Puestos created successfully<br />";
							} else {
								echo "Error creating table: " . $conn->error."<br />";
							}
							
							
							

							// sql to create table Departamentos
							$sql = "CREATE TABLE Departamentos (
							Id_departamento INT AUTO_INCREMENT,
							Nombre_dpto VARCHAR (20) NOT NULL,
							CONSTRAINT PK PRIMARY KEY (Id_departamento)
							)";

							if ($conn->query($sql) === TRUE) {
								echo "Table Departamentos created successfully<br />";
							} else {
								echo "Error creating table: " . $conn->error."<br />";
							}

							// sql to create table Contratos
							$sql = "CREATE TABLE Contratos (
							Id_contrato INT AUTO_INCREMENT,
							Nombre_cont VARCHAR (20) NOT NULL,
							CONSTRAINT PK PRIMARY KEY (Id_contrato)
							)";

							if ($conn->query($sql) === TRUE) {
								echo "Table Contratos created successfully<br />";
							} else {
								echo "Error creating table: " . $conn->error."<br />";
							}

							// sql to create table Empleados
							$sql = "CREATE TABLE Empleados (
							Id_empleado INT AUTO_INCREMENT UNIQUE,
							Dni VARCHAR (10) NOT NULL,
							Nombre VARCHAR (20) NOT NULL,
							Apellido1 VARCHAR (20) NOT NULL,
							Apellido2 VARCHAR (20) NOT NULL,
							Direccion VARCHAR (30) NOT NULL,
							Fecha_nacimiento DATE NOT NULL,
							Fecha_entrada DATE NOT NULL,
							Id_departamento INT NOT NULL,
							Id_contrato INT NOT NULL,
							Id_puesto_trab INT NOT NULL,

							CONSTRAINT PK PRIMARY KEY (Id_empleado),
							CONSTRAINT FK FOREIGN KEY (Id_departamento) REFERENCES Departamentos (Id_departamento),
							CONSTRAINT FK2 FOREIGN KEY (Id_contrato) REFERENCES Contratos (Id_contrato),
							CONSTRAINT FK3 FOREIGN KEY (Id_puesto_trab) REFERENCES Puestos (Id_puesto)
							)";

							if ($conn->query($sql) === TRUE) {
								echo "Table Empleados created successfully<br />";
							} else {
								echo "Error creating table: " . $conn->error."<br />";
							}

							// sql to create table Pedidos
							$sql = "CREATE TABLE Pedidos(
							Id_pedido INT(10) NOT NULL ,
							Fk_Cliente INT(10) NOT NULL ,
							Fk_Empleado INT(10) NOT NULL ,
							Fk_Producto INT(10) NOT NULL ,
							Fecha DATE,
							Cantidad INT(10) ,
							Subtotal INT(10) ,
							CONSTRAINT PK PRIMARY KEY (Id_pedido,
							  Fk_Cliente , Fk_Empleado , Fk_Producto , Fecha),
							CONSTRAINT FK4 FOREIGN KEY (Fk_Cliente) REFERENCES Clientes (Id_cliente),
							CONSTRAINT FK5 FOREIGN KEY (Fk_Empleado) REFERENCES Empleados (Id_empleado),
							CONSTRAINT FK6 FOREIGN KEY (Fk_Producto) REFERENCES Productos (Id_Producto)
							)";

							if ($conn->query($sql) === TRUE) {
								echo "Table Pedidos created successfully<br />";
							} else {
								echo "Error creating table: " . $conn->error."<br />";
							}

							// sql to create table Venta
							$sql = "CREATE TABLE Ventas(
							Id_venta INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY,
							Id_pedido INT(6) NOT NULL,
							Date_Complete DATE NOT NULL,
							CONSTRAINT FK7 FOREIGN KEY (Id_pedido) REFERENCES Pedidos (Id_pedido)
							)";

							if ($conn->query($sql) === TRUE) {
								echo "Table Ventas created successfully<br />";
							} else {
								echo "Error creating table: " . $conn->error."<br />";
							}

							// Introduce datos en las tablas departamento, contrato y puestos
							insert_departamento(1,"Desarrollo",$conn);
							insert_departamento(2,"Sistemas",$conn);
							insert_departamento(3,"Testing",$conn);
							insert_contrato(1,"Fijo",$conn);
							insert_contrato(2,"Indefinido",$conn);
							insert_contrato(3,"Beca Estudios",$conn);
							insert_puestos(1,"Junior",15000,"Experiencia menor a 2 años","CFGM",$conn);
							insert_puestos(2,"Senior",22000,"Experiencia superior a 2 años","CFGS",$conn);
							insert_puestos(3,"Manager",30000,"Experiencia superior a 5 años","Ing Tecnico",$conn);
							insert_puestos(4,"Directivo",36000,"Experiencia superior a 10 años","Ing Tecnico",$conn);
							
							
							
							
							$conn->close();
							?>

                    </div>
                    <!-- /.col-lg-12 -->
                </div>
                <!-- /.row -->
            </div>
            <!-- /.container-fluid -->
        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- jQuery -->
    <script src="../bower_components/jquery/dist/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="../bower_components/metisMenu/dist/metisMenu.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="../dist/js/sb-admin-2.js"></script>

</body>

</html>
